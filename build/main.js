var I=Object.defineProperty,Ee=Object.defineProperties,ve=Object.getOwnPropertyDescriptor,Ie=Object.getOwnPropertyDescriptors,be=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var j=(t,e,n)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,P=(t,e)=>{for(var n in e||(e={}))X.call(e,n)&&j(t,n,e[n]);if(k)for(var n of k(e))Oe.call(e,n)&&j(t,n,e[n]);return t},R=(t,e)=>Ee(t,Ie(e));var h=(t,e)=>()=>(t&&(e=t(t=0)),e);var D=(t,e)=>{for(var n in e)I(t,n,{get:e[n],enumerable:!0})},Pe=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of be(e))!X.call(t,i)&&i!==n&&I(t,i,{get:()=>e[i],enumerable:!(o=ve(e,i))||o.enumerable});return t};var V=t=>Pe(I({},"__esModule",{value:!0}),t);function S(t,e){let n=`${q}`;return q+=1,v[n]={handler:e,name:t},function(){delete v[n]}}function w(t,e){let n=!1;return S(t,function(...o){n!==!0&&(n=!0,e(...o))})}function Z(t,e){let n=!1;for(let o in v)v[o].name===t&&(v[o].handler.apply(null,e),n=!0);if(n===!1)throw new Error(`No event handler with name \`${t}\``)}var v,q,y,K=h(()=>{v={},q=0;y=typeof window=="undefined"?function(t,...e){figma.ui.postMessage([t,...e])}:function(t,...e){window.parent.postMessage({pluginMessage:[t,...e]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(t){if(!Array.isArray(t))return;let[e,...n]=t;typeof e=="string"&&Z(e,n)}:window.onmessage=function(t){if(typeof t.data.pluginMessage=="undefined")return;let e=t.data.pluginMessage;if(!Array.isArray(e))return;let[n,...o]=t.data.pluginMessage;typeof n=="string"&&Z(n,o)}});function C(t,e){if(typeof __html__=="undefined")throw new Error("No UI defined");let n=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof e=="undefined"?{}:e)};${__html__}</script>`;figma.showUI(n,R(P({},t),{themeColors:typeof t.themeColors=="undefined"?!0:t.themeColors}))}var J=h(()=>{});var Q=h(()=>{K();J()});function Re(t,e){return t.family===e.family&&t.style===e.style}function Y(t){return`${t.family}||${t.style}`}function ee(t){let e={Thin:"100","Extra Light":"200",Light:"300",Regular:"400",Medium:"500","Semi Bold":"600",Bold:"700","Extra Bold":"800",Black:"900"},n=t.match(/\d{3}/);if(n)return n[0];for(let[o,i]of Object.entries(e))if(t.includes(o))return i;return t}function te(t,e,n){let o;e!==void 0&&n!==void 0?o=t.getRangeLineHeight(e,n):o=t.lineHeight,o===figma.mixed&&(o=t.getRangeLineHeight(0,1));let i=o;if(i.unit==="PIXELS"&&"value"in i)return i.value;if(i.unit==="PERCENT"&&"value"in i){let s=e!==void 0&&n!==void 0?t.getRangeFontSize(e,n):t.fontSize;return(s===figma.mixed?16:s)*i.value/100}else{let s=e!==void 0&&n!==void 0?t.getRangeFontSize(e,n):t.fontSize;return(s===figma.mixed?16:s)*1.2}}function b(t){let e=[];function n(i){let s=i.characters.length;if(s!==0)try{let l=i.fontName;if(l!==figma.mixed){let c=l,a=i.fontSize;e.push({nodeId:i.id,nodeName:i.name,rangeStart:0,rangeEnd:s,font:{family:c.family,style:c.style},fontSize:a,lineHeightPx:te(i),fontWeight:ee(c.style)})}else{let c=0;for(;c<s;){let a=i.getRangeFontName(c,c+1),f=i.getRangeFontSize(c,c+1),r=c+1;for(;r<s;){let m=i.getRangeFontName(r,r+1),d=i.getRangeFontSize(r,r+1);if(!Re(a,m)||f!==d)break;r++}e.push({nodeId:i.id,nodeName:i.name,rangeStart:c,rangeEnd:r,font:{family:a.family,style:a.style},fontSize:f,lineHeightPx:te(i,c,r),fontWeight:ee(a.style)}),c=r}}}catch(l){console.warn(`Failed to process text node ${i.id}:`,l)}}function o(i){if(i.type==="TEXT")n(i);else if("children"in i)for(let s of i.children)o(s)}for(let i of t)o(i);return e}function $(t){let e=new Map;for(let n of t){let o=Y(n.font),i=e.get(o);if(!i){let s=new Set,l=[];for(let c of t)Y(c.font)===o&&(l.push(c),s.add(c.nodeId));i={font:n.font,count:l.length,nodesCount:s.size,occurrences:l},e.set(o,i)}}return Array.from(e.values()).sort((n,o)=>o.count-n.count)}function we(t){let e=new Map;for(let n of t){let o=Math.round(n.lineHeightPx).toString(),i=e.get(o)||[];i.push(n),e.set(o,i)}return Array.from(e.entries()).map(([n,o])=>({key:`lineHeight:${n}`,label:`Line Height: ${n}px`,occurrences:o,count:o.length}))}function Ce(t){let e=new Map;for(let n of t){let o=Math.round(n.fontSize).toString(),i=e.get(o)||[];i.push(n),e.set(o,i)}return Array.from(e.entries()).map(([n,o])=>({key:`fontSize:${n}`,label:`Font Size: ${n}px`,occurrences:o,count:o.length}))}function $e(t){let e=new Map;for(let n of t){let o=n.fontWeight,i=e.get(o)||[];i.push(n),e.set(o,i)}return Array.from(e.entries()).map(([n,o])=>({key:`fontWeight:${n}`,label:`Weight: ${n}`,occurrences:o,count:o.length}))}function Me(t){let e=new Map;for(let n of t){let o=n.font.family,i=e.get(o)||[];i.push(n),e.set(o,i)}return Array.from(e.entries()).map(([n,o])=>({key:`fontFamily:${n}`,label:`Family: ${n}`,occurrences:o,count:o.length}))}function M(t){return{lineHeight:we(t),fontSize:Ce(t),fontWeight:$e(t),fontFamily:Me(t)}}var ne=h(()=>{"use strict"});function ze(t){if("leading"in t&&"lineGap"in t)throw new Error("Only a single line height style can be provided. Please pass either `lineGap` OR `leading`.");if("capHeight"in t&&"fontSize"in t)throw new Error("Please pass either `capHeight` OR `fontSize`, not both.");let{fontMetrics:e}=t,n=e.capHeight/e.unitsPerEm,o,i;if("capHeight"in t)o=t.capHeight/n,i=t.capHeight;else if("fontSize"in t)o=t.fontSize,i=t.fontSize*n;else throw new Error("Please pass either `capHeight` OR `fontSize`.");let s;return"lineGap"in t?s=i+t.lineGap:"leading"in t&&(s=t.leading),{fontSize:o,lineHeight:s,fontMetrics:e}}function oe(t){let{fontSize:e,lineHeight:n,fontMetrics:o}=ze(t),i=Math.abs(o.descent),s=o.capHeight/o.unitsPerEm,l=i/o.unitsPerEm,c=o.ascent/o.unitsPerEm,a=o.lineGap/o.unitsPerEm,m=(o.ascent+o.lineGap+i)/o.unitsPerEm*e,d=p=>{if(n){let T=(m-n)/2;return p-T/e}return p},u=d(c-s+a/2)*-1,H=d(l+a/2)*-1;return{fontSize:`${O(e)}px`,lineHeight:n?`${O(n)}px`:"normal",capHeightTrim:`${O(u)}em`,baselineTrim:`${O(H)}em`}}var O,ie=h(()=>{O=t=>parseFloat(t.toFixed(4))});var re,ae=h(()=>{re={familyName:"Arial",category:"sans-serif",capHeight:1467,ascent:1854,descent:-434,lineGap:67,unitsPerEm:2048,xHeight:1062,xWidthAvg:913,subsets:{latin:{xWidthAvg:913},thai:{xWidthAvg:1536}}}});var z,se=h(()=>{z={familyName:"Helvetica",category:"sans-serif",capHeight:1469,ascent:1577,descent:-471,lineGap:0,unitsPerEm:2048,xHeight:1071,xWidthAvg:913,subsets:{latin:{xWidthAvg:913},thai:{xWidthAvg:1298}}}});var ce,le=h(()=>{ce={familyName:"Roboto",category:"sans-serif",capHeight:1456,ascent:1900,descent:-500,lineGap:0,unitsPerEm:2048,xHeight:1082,xWidthAvg:911,subsets:{latin:{xWidthAvg:911},thai:{xWidthAvg:908}}}});var fe,ue=h(()=>{fe={familyName:"Inter",category:"sans-serif",capHeight:2048,ascent:2728,descent:-680,lineGap:0,unitsPerEm:2816,xHeight:1536,xWidthAvg:1344,subsets:{latin:{xWidthAvg:1344},thai:{xWidthAvg:2800}}}});var me,de=h(()=>{me={familyName:"Open Sans",category:"sans-serif",capHeight:1462,ascent:2189,descent:-600,lineGap:0,unitsPerEm:2048,xHeight:1096,xWidthAvg:960,subsets:{latin:{xWidthAvg:960},thai:{xWidthAvg:1229}}}});var ge,he=h(()=>{ge={familyName:"Montserrat",category:"sans-serif",capHeight:700,ascent:968,descent:-251,lineGap:0,unitsPerEm:1e3,xHeight:517,xWidthAvg:503,subsets:{latin:{xWidthAvg:503},thai:{xWidthAvg:587}}}});var pe,ye=h(()=>{pe={familyName:"Lato",category:"sans-serif",capHeight:1433,ascent:1974,descent:-426,lineGap:0,unitsPerEm:2e3,xHeight:1013,xWidthAvg:871,subsets:{latin:{xWidthAvg:871},thai:{xWidthAvg:1063}}}});var xe,He=h(()=>{xe={familyName:"Poppins",category:"sans-serif",capHeight:698,ascent:1050,descent:-350,lineGap:100,unitsPerEm:1e3,xHeight:548,xWidthAvg:500,subsets:{latin:{xWidthAvg:500},thai:{xWidthAvg:500}}}});var Se,Te=h(()=>{Se={familyName:"Raleway",category:"sans-serif",capHeight:710,ascent:940,descent:-234,lineGap:0,unitsPerEm:1e3,xHeight:519,xWidthAvg:463,subsets:{latin:{xWidthAvg:463},thai:{xWidthAvg:608}}}});var Fe,Ne=h(()=>{Fe={familyName:"Source Sans 3",category:"sans-serif",capHeight:660,ascent:1024,descent:-400,lineGap:0,unitsPerEm:1e3,xHeight:486,xWidthAvg:418,subsets:{latin:{xWidthAvg:418},thai:{xWidthAvg:653}}}});var B={};D(B,{calculateLineOverlap:()=>Ze,calculateTrimValues:()=>Be,calculateUniversalLineHeight:()=>je,checkLineHeightIssue:()=>Ve,getFontMetrics:()=>_e,getLineHeightInPixels:()=>ke,getRecommendedLineHeight:()=>Le,hasMixedFontSizes:()=>We,hasMixedFonts:()=>Ge,hasMixedLineHeights:()=>Ue,isLineHeightTooTight:()=>qe});function _e(t){if(_[t])return _[t];let e=t.toLowerCase();for(let[n,o]of Object.entries(_))if(n.toLowerCase()===e)return o;return null}function Be(t,e,n){try{let o=oe({fontSize:t,leading:e,fontMetrics:n});console.log("[Capsize Debug] Raw values:",{fontSize:t,lineHeightPx:e,capHeightTrim:o.capHeightTrim,baselineTrim:o.baselineTrim,fontMetrics:{familyName:n.familyName,capHeight:n.capHeight,ascent:n.ascent,descent:n.descent,unitsPerEm:n.unitsPerEm}});let i=Math.round(parseFloat(o.capHeightTrim)*t),s=Math.round(parseFloat(o.baselineTrim)*t);return console.log("[Capsize Debug] Calculated:",{topTrimRaw:parseFloat(o.capHeightTrim)*t,bottomTrimRaw:parseFloat(o.baselineTrim)*t,topTrimRounded:i,bottomTrimRounded:s}),{topTrim:Math.abs(i),bottomTrim:Math.abs(s)}}catch(o){return console.error("Error calculating trim values:",o),{topTrim:0,bottomTrim:0}}}function Ge(t){if(t.characters.length===0)return!1;let e=t.getRangeFontName(0,1);if(e===figma.mixed)return!0;for(let n=1;n<t.characters.length;n++){let o=t.getRangeFontName(n,n+1);if(o===figma.mixed||typeof e!="symbol"&&typeof o!="symbol"&&(e.family!==o.family||e.style!==o.style))return!0}return!1}function We(t){if(t.characters.length===0)return!1;let e=t.getRangeFontSize(0,1);if(e===figma.mixed)return!0;for(let n=1;n<t.characters.length;n++){let o=t.getRangeFontSize(n,n+1);if(o===figma.mixed||o!==e)return!0}return!1}function Ue(t){if(t.characters.length===0)return!1;let e=t.getRangeLineHeight(0,1);if(e===figma.mixed)return!0;for(let n=1;n<t.characters.length;n++){let o=t.getRangeLineHeight(n,n+1);if(o===figma.mixed||typeof e!="symbol"&&typeof o!="symbol"&&(e.unit!==o.unit||e.unit!=="AUTO"&&o.unit!=="AUTO"&&"value"in e&&"value"in o&&e.value!==o.value))return!0}return!1}function ke(t){let e=t.lineHeight,n=typeof t.fontSize=="number"?t.fontSize:16;if(e===figma.mixed){console.log("[getLineHeightInPixels] Mixed line height detected, checking first character");let o=t.getRangeLineHeight(0,1);if(o!==figma.mixed){if(o.unit==="PIXELS")return console.log("[getLineHeightInPixels] First char PIXELS:",o.value),o.value;if(o.unit==="PERCENT"){let i=o.value/100*n;return console.log("[getLineHeightInPixels] First char PERCENT:",o.value,"% =",i,"px"),i}else return console.log("[getLineHeightInPixels] First char AUTO, using 120%"),n*1.2}}else{if(e.unit==="PIXELS")return console.log("[getLineHeightInPixels] PIXELS:",e.value),e.value;if(e.unit==="PERCENT"){let o=e.value/100*n;return console.log("[getLineHeightInPixels] PERCENT:",e.value,"% =",o,"px"),o}else return console.log("[getLineHeightInPixels] AUTO, using 120%"),n*1.2}return console.log("[getLineHeightInPixels] Fallback to default"),16*1.2}function je(t,e){let n=1.5;e&&(e<=300?n=1.45:e<=400?n=1.5:e<=600?n=1.55:n=1.6);let o=8,i=t*n;return Math.max(i,t+o)}function Ve(t,e){let n=e/t;return n<Ae?{hasIssue:!0,issueType:"TOO_TIGHT",ratio:n}:n>Xe?{hasIssue:!0,issueType:"TOO_LOOSE",ratio:n}:{hasIssue:!1,issueType:"OPTIMAL",ratio:n}}function qe(t,e){return e/t<Ae}function Le(t){return Math.round(t*De)}function Ze(t,e){let n=Le(t),o=Math.abs(n-e);return Math.round(o)}var _,Ae,Xe,De,G=h(()=>{"use strict";ie();ae();se();le();ue();de();he();ye();He();Te();Ne();_={Arial:re,Helvetica:z,"Helvetica Neue":z,Roboto:ce,Inter:fe,"Open Sans":me,Montserrat:ge,Lato:pe,Poppins:xe,Raleway:Se,"Source Sans 3":Fe};Ae=1.3,Xe=1.7,De=1.5});var W={};D(W,{default:()=>Ke});function Ke(){S("SCAN_FONTS",async function(){let t=figma.currentPage.selection;if(t.length===0){figma.notify("Please select at least one layer",{error:!0}),y("FONTS_SCANNED",{fonts:[],groups:{lineHeight:[],fontSize:[],fontWeight:[],fontFamily:[]},totalNodes:0});return}let e=b(t);if(e.length===0){figma.notify("No text layers found in selection"),y("FONTS_SCANNED",{fonts:[],groups:{lineHeight:[],fontSize:[],fontWeight:[],fontFamily:[]},totalNodes:0});return}let n=$(e),o=M(e),i=new Set(e.map(s=>s.nodeId));y("FONTS_SCANNED",{fonts:n,groups:o,totalNodes:i.size}),figma.notify(`Found ${n.length} fonts in ${i.size} text layers`)}),S("APPLY_REPLACEMENT",async function(t){let e={success:!1,affectedNodes:0,affectedRanges:0,errors:[]};try{await figma.loadFontAsync({family:t.newFont.family,style:t.newFont.style});let n=new Set;for(let o of t.occurrences)try{let i=figma.getNodeById(o.nodeId);if(!i||i.type!=="TEXT")continue;try{await figma.loadFontAsync({family:o.font.family,style:o.font.style})}catch(s){}if(i.setRangeFontName(o.rangeStart,o.rangeEnd,{family:t.newFont.family,style:t.newFont.style}),t.newLineHeight)try{i.setRangeLineHeight(o.rangeStart,o.rangeEnd,{value:t.newLineHeight,unit:"PIXELS"})}catch(s){i.lineHeight={value:t.newLineHeight,unit:"PIXELS"}}if(t.newFontSize)try{i.setRangeFontSize(o.rangeStart,o.rangeEnd,t.newFontSize)}catch(s){i.fontSize=t.newFontSize}e.affectedRanges++,n.add(i.id)}catch(i){e.errors.push(`Error updating node ${o.nodeId}: ${i}`)}e.affectedNodes=n.size,e.success=e.affectedRanges>0,e.success?figma.notify(`Updated ${e.affectedRanges} text ranges in ${e.affectedNodes} layers`):figma.notify("Failed to apply changes",{error:!0})}catch(n){e.errors.push(`Font loading failed: ${n}`),figma.notify("Failed to load font",{error:!0})}y("REPLACEMENT_COMPLETE",e)}),S("BULK_UPDATE",async function(t){let e=0,n=0,o=new Set,i=[];try{let s=async(l,c)=>{let f=(await figma.listAvailableFontsAsync()).filter(u=>u.fontName.family===l);if(f.length===0)return null;let m={100:["Thin","Hairline","100","100 Thin"],200:["Extra Light","ExtraLight","Ultra Light","UltraLight","200","200 Extra Light"],300:["Light","Lt","300","300 Light"],400:["Regular","Normal","Book","Rg","400","400 Regular"],500:["Medium","Md","500","500 Medium"],600:["Semi Bold","SemiBold","Demi Bold","DemiBold","600","600 Semi Bold"],700:["Bold","Bd","700","700 Bold"],800:["Extra Bold","ExtraBold","Ultra Bold","UltraBold","800","800 Extra Bold"],900:["Black","Heavy","Bk","900","900 Black"]}[c]||[];for(let u of m){let H=f.find(p=>p.fontName.style.toLowerCase()===u.toLowerCase());if(H)return H.fontName.style}for(let u of m){let H=f.find(p=>p.fontName.style.toLowerCase().includes(u.toLowerCase()));if(H)return H.fontName.style}let d=f.find(u=>u.fontName.style.toLowerCase()==="regular"||u.fontName.style.toLowerCase()==="normal"||u.fontName.style.toLowerCase()==="400");return d?d.fontName.style:f[0].fontName.style};for(let l of t.occurrences)try{let c=figma.getNodeById(l.nodeId);if(!c||c.type!=="TEXT")continue;try{await figma.loadFontAsync({family:l.font.family,style:l.font.style})}catch(a){i.push(`Failed to load font ${l.font.family} ${l.font.style}`);continue}if(t.groupType==="fontWeight"){let a=t.targetValue,f=await s(l.font.family,a);if(!f){i.push(`Could not find matching weight ${a} for ${l.font.family}`);continue}await figma.loadFontAsync({family:l.font.family,style:f}),c.setRangeFontName(l.rangeStart,l.rangeEnd,{family:l.font.family,style:f}),e++}else if(t.groupType==="lineHeight"){let a=t.targetValue;try{c.setRangeLineHeight(l.rangeStart,l.rangeEnd,{value:a,unit:"PIXELS"})}catch(f){c.lineHeight={value:a,unit:"PIXELS"}}e++}else if(t.groupType==="fontSize"){let a=t.targetValue;try{c.setRangeFontSize(l.rangeStart,l.rangeEnd,a)}catch(f){c.fontSize=a}e++}o.add(c.id)}catch(c){i.push(`Error updating node ${l.nodeId}: ${c}`)}n=o.size,e>0?(figma.notify(`Updated ${e} range${e===1?"":"s"} in ${n} layer${n===1?"":"s"}`),y("FONTS_SCANNED",{fonts:$(b(figma.currentPage.selection)),groups:M(b(figma.currentPage.selection)),totalNodes:o.size})):(figma.notify("No changes applied",{error:!0}),i.length>0&&console.error("Bulk update errors:",i))}catch(s){figma.notify(`Bulk update failed: ${s}`,{error:!0}),console.error("Bulk update error:",s)}}),S("PREVIEW_SELECTION",function(t){let e=new Set(t.map(o=>o.nodeId)),n=[];for(let o of Array.from(e)){let i=figma.getNodeById(o);i&&n.push(i)}n.length>0&&(figma.currentPage.selection=n,figma.viewport.scrollAndZoomIntoView(n))}),S("REQUEST_AVAILABLE_FONTS",async function(){let t=await figma.listAvailableFontsAsync();y("AVAILABLE_FONTS",t)}),S("TRIM_TEXT",async function(){let t=figma.currentPage.selection,e={success:!1,trimmedNodes:0,trimmedTexts:[],errors:[]};if(t.length===0){e.errors.push("Please select at least one text layer"),figma.notify("Please select at least one text layer",{error:!0}),y("TRIM_COMPLETE",e);return}let{getFontMetrics:n,calculateTrimValues:o,hasMixedFonts:i,hasMixedFontSizes:s,hasMixedLineHeights:l,getLineHeightInPixels:c}=await Promise.resolve().then(()=>(G(),B));function a(r){let m=[];for(let d of r)d.type==="TEXT"?m.push(d):"children"in d&&m.push(...a(d.children));return m}let f=a(t);if(f.length===0){e.errors.push("No text layers found in selection"),figma.notify("No text layers found in selection",{error:!0}),y("TRIM_COMPLETE",e);return}for(let r of f)try{if(i(r)){e.errors.push(`${r.name}: Text has mixed fonts, cannot trim`);continue}if(s(r)){e.errors.push(`${r.name}: Text has mixed font sizes, cannot trim`);continue}if(l(r)){e.errors.push(`${r.name}: Text has mixed line heights, cannot trim`);continue}let m=r.fontName;if(m===figma.mixed){e.errors.push(`${r.name}: Cannot determine font`);continue}let d=r.fontSize;if(d===figma.mixed){e.errors.push(`${r.name}: Cannot determine font size`);continue}let u=c(r);console.log(`[Trim Debug] ${r.name}:`,{fontSize:d,lineHeightPx:u,fontFamily:m.family,lineHeightRaw:r.lineHeight});let H=n(m.family);if(!H){e.errors.push(`${r.name}: Font "${m.family}" is not currently supported. Try Arial, Roboto, Inter, or other common fonts.`);continue}let{topTrim:p,bottomTrim:T}=o(d,u,H);if(console.log("[Trim Debug] Calculated trims:",{topTrim:p,bottomTrim:T,ratio:u/d}),p===0&&T===0){e.errors.push(`${r.name}: Could not calculate trim values`);continue}try{await figma.loadFontAsync({family:m.family,style:m.style})}catch(N){e.errors.push(`${r.name}: Failed to load font "${m.family} ${m.style}"`);continue}r.textAutoResize==="NONE"&&(r.textAutoResize="HEIGHT");let g=figma.createFrame();g.name=`${r.name} (Trimmed)`,g.layoutMode="VERTICAL",g.primaryAxisSizingMode="AUTO",g.counterAxisSizingMode="AUTO",g.paddingTop=0,g.paddingBottom=0,g.paddingLeft=0,g.paddingRight=0,g.fills=[],g.clipsContent=!1,g.x=r.x-p,g.y=r.y-p;let x=r.parent,F=0;x&&"children"in x&&(F=x.children.indexOf(r)),x&&"appendChild"in x&&g.appendChild(r),r.x=0,r.y=-p;let A=u-p-T;g.resize(r.width,A),x&&"insertChild"in x&&x.insertChild(F,g),e.trimmedTexts.push({nodeId:r.id,nodeName:r.name,font:{family:m.family,style:m.style},fontSize:d,lineHeight:u,topTrim:p,bottomTrim:T}),e.trimmedNodes++}catch(m){e.errors.push(`${r.name}: ${m}`)}e.success=e.trimmedNodes>0,e.success?figma.notify(`Successfully trimmed ${e.trimmedNodes} text layer${e.trimmedNodes!==1?"s":""}`):figma.notify("Failed to trim text layers",{error:!0}),y("TRIM_COMPLETE",e)}),S("SCAN_LINE_HEIGHTS",async function(){let t=figma.currentPage.selection,e={totalScanned:0,issuesFound:0,textLayers:[]};if(t.length===0){figma.notify("Please select at least one text layer",{error:!0}),y("LINE_HEIGHT_SCAN_COMPLETE",e);return}let{getLineHeightInPixels:n,checkLineHeightIssue:o,getRecommendedLineHeight:i,calculateLineOverlap:s}=await Promise.resolve().then(()=>(G(),B));function l(a){let f=[];for(let r of a)r.type==="TEXT"?f.push(r):"children"in r&&f.push(...l(r.children));return f}let c=l(t);if(c.length===0){figma.notify("No text layers found in selection",{error:!0}),y("LINE_HEIGHT_SCAN_COMPLETE",e);return}for(let a of c)try{let f=a.fontName;if(f===figma.mixed){console.log(`[LH Scan] Skipping ${a.name}: mixed fonts`);continue}let r=a.fontSize;if(r===figma.mixed){console.log(`[LH Scan] Skipping ${a.name}: mixed font sizes`);continue}if(a.lineHeight===figma.mixed){console.log(`[LH Scan] WARNING: ${a.name} has mixed line heights!`),console.log("[LH Scan] Checking all characters to find worst case...");let T=a.characters,g=1.5,x=r*1.5,F=!1,A="OPTIMAL";for(let N=0;N<T.length;N++){let E=a.getRangeLineHeight(N,N+1);if(E!==figma.mixed&&E.unit==="PIXELS"){let L=E.value/r;L<1.3?(!F||L<g)&&(g=L,x=E.value,A="TOO_TIGHT",F=!0):L>1.7&&(!F||L>g)&&(g=L,x=E.value,A="TOO_LOOSE",F=!0)}}if(F){console.log(`[LH Scan] Worst case in ${a.name}:`,{lineHeight:x,ratio:g.toFixed(2),issueType:A});let N=i(r);e.textLayers.push({nodeId:a.id,nodeName:`${a.name} (mixed)`,fontFamily:f.family,fontStyle:f.style,fontSize:r,lineHeight:x,lineHeightRatio:g,hasIssue:!0,issueType:A,recommendedLineHeight:N,overlapAmount:Math.abs(N-x)}),e.totalScanned++,e.issuesFound++}else console.log(`[LH Scan] ${a.name} has mixed line heights but all are optimal`);continue}let d=n(a),u=o(r,d),H=i(r),p=s(r,d);console.log(`[LH Scan] ${a.name}:`,{fontSize:r,lineHeight:d,ratio:u.ratio.toFixed(2),issueType:u.issueType,hasIssue:u.hasIssue,recommended:H}),e.textLayers.push({nodeId:a.id,nodeName:a.name,fontFamily:f.family,fontStyle:f.style,fontSize:r,lineHeight:d,lineHeightRatio:u.ratio,hasIssue:u.hasIssue,issueType:u.issueType,recommendedLineHeight:u.hasIssue?H:void 0,overlapAmount:u.hasIssue?p:void 0}),e.totalScanned++,u.hasIssue&&e.issuesFound++}catch(f){console.error(`[LH Scan] Error scanning ${a.name}:`,f)}e.issuesFound>0?figma.notify(`Found ${e.issuesFound} line height issue${e.issuesFound===1?"":"s"}`):figma.notify("All line heights are optimal!"),y("LINE_HEIGHT_SCAN_COMPLETE",e)}),S("FIX_LINE_HEIGHT",async function(t){try{let e=figma.getNodeById(t.nodeId);if(!e||e.type!=="TEXT"){figma.notify("Text layer not found",{error:!0});return}let n=e.fontName;if(n===figma.mixed){figma.notify("Cannot fix text with mixed fonts",{error:!0});return}await figma.loadFontAsync({family:n.family,style:n.style}),e.lineHeight={value:t.newLineHeight,unit:"PIXELS"},figma.notify(`\u2713 Updated "${e.name}" line height to ${t.newLineHeight}px`),y("SCAN_LINE_HEIGHTS")}catch(e){figma.notify(`Failed to fix line height: ${e}`,{error:!0})}}),S("SELECT_NODE",function(t){let e=figma.getNodeById(t.nodeId);e&&(figma.currentPage.selection=[e],figma.viewport.scrollAndZoomIntoView([e]))}),w("close",function(){figma.closePlugin()}),C({width:380,height:480})}var U=h(()=>{"use strict";Q();ne()});var Je={"src/main.ts--default":(U(),V(W)).default,open:(U(),V(W)).default},Qe=typeof figma.command=="undefined"||figma.command===""||figma.command==="generate"?"src/main.ts--default":figma.command;Je[Qe]();
