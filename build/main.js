var x=Object.defineProperty,W=Object.defineProperties,D=Object.getOwnPropertyDescriptor,V=Object.getOwnPropertyDescriptors,X=Object.getOwnPropertyNames,R=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var I=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M=(e,t)=>{for(var n in t||(t={}))v.call(t,n)&&I(e,n,t[n]);if(R)for(var n of R(t))q.call(t,n)&&I(e,n,t[n]);return e},C=(e,t)=>W(e,V(t));var p=(e,t)=>()=>(e&&(t=e(e=0)),t);var j=(e,t)=>{for(var n in t)x(e,n,{get:t[n],enumerable:!0})},K=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of X(t))!v.call(e,o)&&o!==n&&x(e,o,{get:()=>t[o],enumerable:!(r=D(t,o))||r.enumerable});return e};var T=e=>K(x({},"__esModule",{value:!0}),e);function m(e,t){let n=`${O}`;return O+=1,y[n]={handler:t,name:e},function(){delete y[n]}}function w(e,t){let n=!1;return m(e,function(...r){n!==!0&&(n=!0,t(...r))})}function z(e,t){let n=!1;for(let r in y)y[r].name===e&&(y[r].handler.apply(null,t),n=!0);if(n===!1)throw new Error(`No event handler with name \`${e}\``)}var y,O,d,b=p(()=>{y={},O=0;d=typeof window=="undefined"?function(e,...t){figma.ui.postMessage([e,...t])}:function(e,...t){window.parent.postMessage({pluginMessage:[e,...t]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(e){if(!Array.isArray(e))return;let[t,...n]=e;typeof t=="string"&&z(t,n)}:window.onmessage=function(e){if(typeof e.data.pluginMessage=="undefined")return;let t=e.data.pluginMessage;if(!Array.isArray(t))return;let[n,...r]=e.data.pluginMessage;typeof n=="string"&&z(n,r)}});function A(e,t){if(typeof __html__=="undefined")throw new Error("No UI defined");let n=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof t=="undefined"?{}:t)};${__html__}</script>`;figma.showUI(n,C(M({},e),{themeColors:typeof e.themeColors=="undefined"?!0:e.themeColors}))}var $=p(()=>{});var P=p(()=>{b();$()});function J(e,t){return e.family===t.family&&e.style===t.style}function _(e){return`${e.family}||${e.style}`}function U(e){let t={Thin:"100","Extra Light":"200",Light:"300",Regular:"400",Medium:"500","Semi Bold":"600",Bold:"700","Extra Bold":"800",Black:"900"},n=e.match(/\d{3}/);if(n)return n[0];for(let[r,o]of Object.entries(t))if(e.includes(r))return o;return e}function k(e,t,n){let r;t!==void 0&&n!==void 0?r=e.getRangeLineHeight(t,n):r=e.lineHeight,r===figma.mixed&&(r=e.getRangeLineHeight(0,1));let o=r;if(o.unit==="PIXELS"&&"value"in o)return o.value;if(o.unit==="PERCENT"&&"value"in o){let s=t!==void 0&&n!==void 0?e.getRangeFontSize(t,n):e.fontSize;return(s===figma.mixed?16:s)*o.value/100}else{let s=t!==void 0&&n!==void 0?e.getRangeFontSize(t,n):e.fontSize;return(s===figma.mixed?16:s)*1.2}}function S(e){let t=[];function n(o){let s=o.characters.length;if(s!==0)try{let i=o.fontName;if(i!==figma.mixed){let a=i,c=o.fontSize;t.push({nodeId:o.id,nodeName:o.name,rangeStart:0,rangeEnd:s,font:{family:a.family,style:a.style},fontSize:c,lineHeightPx:k(o),fontWeight:U(a.style)})}else{let a=0;for(;a<s;){let c=o.getRangeFontName(a,a+1),f=o.getRangeFontSize(a,a+1),l=a+1;for(;l<s;){let h=o.getRangeFontName(l,l+1),F=o.getRangeFontSize(l,l+1);if(!J(c,h)||f!==F)break;l++}t.push({nodeId:o.id,nodeName:o.name,rangeStart:a,rangeEnd:l,font:{family:c.family,style:c.style},fontSize:f,lineHeightPx:k(o,a,l),fontWeight:U(c.style)}),a=l}}}catch(i){console.warn(`Failed to process text node ${o.id}:`,i)}}function r(o){if(o.type==="TEXT")n(o);else if("children"in o)for(let s of o.children)r(s)}for(let o of e)r(o);return t}function E(e){let t=new Map;for(let n of e){let r=_(n.font),o=t.get(r);if(!o){let s=new Set,i=[];for(let a of e)_(a.font)===r&&(i.push(a),s.add(a.nodeId));o={font:n.font,count:i.length,nodesCount:s.size,occurrences:i},t.set(r,o)}}return Array.from(t.values()).sort((n,r)=>r.count-n.count)}function Q(e){let t=new Map;for(let n of e){let r=Math.round(n.lineHeightPx).toString(),o=t.get(r)||[];o.push(n),t.set(r,o)}return Array.from(t.entries()).map(([n,r])=>({key:`lineHeight:${n}`,label:`Line Height: ${n}px`,occurrences:r,count:r.length}))}function Y(e){let t=new Map;for(let n of e){let r=Math.round(n.fontSize).toString(),o=t.get(r)||[];o.push(n),t.set(r,o)}return Array.from(t.entries()).map(([n,r])=>({key:`fontSize:${n}`,label:`Font Size: ${n}px`,occurrences:r,count:r.length}))}function Z(e){let t=new Map;for(let n of e){let r=n.fontWeight,o=t.get(r)||[];o.push(n),t.set(r,o)}return Array.from(t.entries()).map(([n,r])=>({key:`fontWeight:${n}`,label:`Weight: ${n}`,occurrences:r,count:r.length}))}function ee(e){let t=new Map;for(let n of e){let r=n.font.family,o=t.get(r)||[];o.push(n),t.set(r,o)}return Array.from(t.entries()).map(([n,r])=>({key:`fontFamily:${n}`,label:`Family: ${n}`,occurrences:r,count:r.length}))}function B(e){return{lineHeight:Q(e),fontSize:Y(e),fontWeight:Z(e),fontFamily:ee(e)}}var G=p(()=>{"use strict"});var L={};j(L,{default:()=>te});function te(){m("SCAN_FONTS",async function(){let e=figma.currentPage.selection;if(e.length===0){figma.notify("Please select at least one layer",{error:!0});return}let t=S(e);if(t.length===0){figma.notify("No text layers found in selection");return}let n=E(t),r=B(t),o=new Set(t.map(s=>s.nodeId));d("FONTS_SCANNED",{fonts:n,groups:r,totalNodes:o.size}),figma.notify(`Found ${n.length} fonts in ${o.size} text layers`)}),m("APPLY_REPLACEMENT",async function(e){let t={success:!1,affectedNodes:0,affectedRanges:0,errors:[]};try{await figma.loadFontAsync({family:e.newFont.family,style:e.newFont.style});let n=new Set;for(let r of e.occurrences)try{let o=figma.getNodeById(r.nodeId);if(!o||o.type!=="TEXT")continue;try{await figma.loadFontAsync({family:r.font.family,style:r.font.style})}catch(s){}if(o.setRangeFontName(r.rangeStart,r.rangeEnd,{family:e.newFont.family,style:e.newFont.style}),e.newLineHeight)try{o.setRangeLineHeight(r.rangeStart,r.rangeEnd,{value:e.newLineHeight,unit:"PIXELS"})}catch(s){o.lineHeight={value:e.newLineHeight,unit:"PIXELS"}}if(e.newFontSize)try{o.setRangeFontSize(r.rangeStart,r.rangeEnd,e.newFontSize)}catch(s){o.fontSize=e.newFontSize}t.affectedRanges++,n.add(o.id)}catch(o){t.errors.push(`Error updating node ${r.nodeId}: ${o}`)}t.affectedNodes=n.size,t.success=t.affectedRanges>0,t.success?figma.notify(`Updated ${t.affectedRanges} text ranges in ${t.affectedNodes} layers`):figma.notify("Failed to apply changes",{error:!0})}catch(n){t.errors.push(`Font loading failed: ${n}`),figma.notify("Failed to load font",{error:!0})}d("REPLACEMENT_COMPLETE",t)}),m("BULK_UPDATE",async function(e){let t=0,n=0,r=new Set,o=[];try{let s=async(i,a)=>{let f=(await figma.listAvailableFontsAsync()).filter(u=>u.fontName.family===i);if(f.length===0)return null;let h={100:["Thin","Hairline","100","100 Thin"],200:["Extra Light","ExtraLight","Ultra Light","UltraLight","200","200 Extra Light"],300:["Light","Lt","300","300 Light"],400:["Regular","Normal","Book","Rg","400","400 Regular"],500:["Medium","Md","500","500 Medium"],600:["Semi Bold","SemiBold","Demi Bold","DemiBold","600","600 Semi Bold"],700:["Bold","Bd","700","700 Bold"],800:["Extra Bold","ExtraBold","Ultra Bold","UltraBold","800","800 Extra Bold"],900:["Black","Heavy","Bk","900","900 Black"]}[a]||[];for(let u of h){let g=f.find(N=>N.fontName.style.toLowerCase()===u.toLowerCase());if(g)return g.fontName.style}for(let u of h){let g=f.find(N=>N.fontName.style.toLowerCase().includes(u.toLowerCase()));if(g)return g.fontName.style}let F=f.find(u=>u.fontName.style.toLowerCase()==="regular"||u.fontName.style.toLowerCase()==="normal"||u.fontName.style.toLowerCase()==="400");return F?F.fontName.style:f[0].fontName.style};for(let i of e.occurrences)try{let a=figma.getNodeById(i.nodeId);if(!a||a.type!=="TEXT")continue;try{await figma.loadFontAsync({family:i.font.family,style:i.font.style})}catch(c){o.push(`Failed to load font ${i.font.family} ${i.font.style}`);continue}if(e.groupType==="fontWeight"){let c=e.targetValue,f=await s(i.font.family,c);if(!f){o.push(`Could not find matching weight ${c} for ${i.font.family}`);continue}await figma.loadFontAsync({family:i.font.family,style:f}),a.setRangeFontName(i.rangeStart,i.rangeEnd,{family:i.font.family,style:f}),t++}else if(e.groupType==="lineHeight"){let c=e.targetValue;try{a.setRangeLineHeight(i.rangeStart,i.rangeEnd,{value:c,unit:"PIXELS"})}catch(f){a.lineHeight={value:c,unit:"PIXELS"}}t++}else if(e.groupType==="fontSize"){let c=e.targetValue;try{a.setRangeFontSize(i.rangeStart,i.rangeEnd,c)}catch(f){a.fontSize=c}t++}r.add(a.id)}catch(a){o.push(`Error updating node ${i.nodeId}: ${a}`)}n=r.size,t>0?(figma.notify(`Updated ${t} range${t===1?"":"s"} in ${n} layer${n===1?"":"s"}`),d("FONTS_SCANNED",{fonts:E(S(figma.currentPage.selection)),groups:B(S(figma.currentPage.selection)),totalNodes:r.size})):(figma.notify("No changes applied",{error:!0}),o.length>0&&console.error("Bulk update errors:",o))}catch(s){figma.notify(`Bulk update failed: ${s}`,{error:!0}),console.error("Bulk update error:",s)}}),m("PREVIEW_SELECTION",function(e){let t=new Set(e.map(r=>r.nodeId)),n=[];for(let r of Array.from(t)){let o=figma.getNodeById(r);o&&n.push(o)}n.length>0&&(figma.currentPage.selection=n,figma.viewport.scrollAndZoomIntoView(n))}),m("REQUEST_AVAILABLE_FONTS",async function(){let e=await figma.listAvailableFontsAsync();d("AVAILABLE_FONTS",e)}),w("close",function(){figma.closePlugin()}),A({width:380,height:600})}var H=p(()=>{"use strict";P();G()});var ne={"src/main.ts--default":(H(),T(L)).default,open:(H(),T(L)).default},oe=typeof figma.command=="undefined"||figma.command===""||figma.command==="generate"?"src/main.ts--default":figma.command;ne[oe]();
