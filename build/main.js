var g=Object.defineProperty,U=Object.defineProperties,G=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyDescriptors,k=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var A=(e,n,t)=>n in e?g(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,N=(e,n)=>{for(var t in n||(n={}))w.call(n,t)&&A(e,t,n[t]);if(S)for(var t of S(n))D.call(n,t)&&A(e,t,n[t]);return e},E=(e,n)=>U(e,W(n));var u=(e,n)=>()=>(e&&(n=e(e=0)),n);var V=(e,n)=>{for(var t in n)g(e,t,{get:n[t],enumerable:!0})},X=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of k(n))!w.call(e,o)&&o!==t&&g(e,o,{get:()=>n[o],enumerable:!(r=G(n,o))||r.enumerable});return e};var I=e=>X(g({},"__esModule",{value:!0}),e);function f(e,n){let t=`${R}`;return R+=1,m[t]={handler:n,name:e},function(){delete m[t]}}function p(e,n){let t=!1;return f(e,function(...r){t!==!0&&(t=!0,n(...r))})}function H(e,n){let t=!1;for(let r in m)m[r].name===e&&(m[r].handler.apply(null,n),t=!0);if(t===!1)throw new Error(`No event handler with name \`${e}\``)}var m,R,d,O=u(()=>{m={},R=0;d=typeof window=="undefined"?function(e,...n){figma.ui.postMessage([e,...n])}:function(e,...n){window.parent.postMessage({pluginMessage:[e,...n]},"*")};typeof window=="undefined"?figma.ui.onmessage=function(e){if(!Array.isArray(e))return;let[n,...t]=e;typeof n=="string"&&H(n,t)}:window.onmessage=function(e){if(typeof e.data.pluginMessage=="undefined")return;let n=e.data.pluginMessage;if(!Array.isArray(n))return;let[t,...r]=e.data.pluginMessage;typeof t=="string"&&H(t,r)}});function y(e,n){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof n=="undefined"?{}:n)};${__html__}</script>`;figma.showUI(t,E(N({},e),{themeColors:typeof e.themeColors=="undefined"?!0:e.themeColors}))}var v=u(()=>{});var M=u(()=>{O();v()});function q(e,n){return e.family===n.family&&e.style===n.style}function C(e){return`${e.family}||${e.style}`}function b(e){let n={Thin:"100","Extra Light":"200",Light:"300",Regular:"400",Medium:"500","Semi Bold":"600",Bold:"700","Extra Bold":"800",Black:"900"},t=e.match(/\d{3}/);if(t)return t[0];for(let[r,o]of Object.entries(n))if(e.includes(r))return o;return e}function z(e,n,t){let r;n!==void 0&&t!==void 0?r=e.getRangeLineHeight(n,t):r=e.lineHeight,r===figma.mixed&&(r=e.getRangeLineHeight(0,1));let o=r;if(o.unit==="PIXELS"&&"value"in o)return o.value;if(o.unit==="PERCENT"&&"value"in o){let i=n!==void 0&&t!==void 0?e.getRangeFontSize(n,t):e.fontSize;return(i===figma.mixed?16:i)*o.value/100}else{let i=n!==void 0&&t!==void 0?e.getRangeFontSize(n,t):e.fontSize;return(i===figma.mixed?16:i)*1.2}}function T(e){let n=[];function t(o){let i=o.characters.length;if(i!==0)try{let s=o.fontName;if(s!==figma.mixed){let a=s,l=o.fontSize;n.push({nodeId:o.id,nodeName:o.name,rangeStart:0,rangeEnd:i,font:{family:a.family,style:a.style},fontSize:l,lineHeightPx:z(o),fontWeight:b(a.style)})}else{let a=0;for(;a<i;){let l=o.getRangeFontName(a,a+1),x=o.getRangeFontSize(a,a+1),c=a+1;for(;c<i;){let P=o.getRangeFontName(c,c+1),$=o.getRangeFontSize(c,c+1);if(!q(l,P)||x!==$)break;c++}n.push({nodeId:o.id,nodeName:o.name,rangeStart:a,rangeEnd:c,font:{family:l.family,style:l.style},fontSize:x,lineHeightPx:z(o,a,c),fontWeight:b(l.style)}),a=c}}}catch(s){console.warn(`Failed to process text node ${o.id}:`,s)}}function r(o){if(o.type==="TEXT")t(o);else if("children"in o)for(let i of o.children)r(i)}for(let o of e)r(o);return n}function L(e){let n=new Map;for(let t of e){let r=C(t.font),o=n.get(r);if(!o){let i=new Set,s=[];for(let a of e)C(a.font)===r&&(s.push(a),i.add(a.nodeId));o={font:t.font,count:s.length,nodesCount:i.size,occurrences:s},n.set(r,o)}}return Array.from(n.values()).sort((t,r)=>r.count-t.count)}function j(e){let n=new Map;for(let t of e){let r=Math.round(t.lineHeightPx).toString(),o=n.get(r)||[];o.push(t),n.set(r,o)}return Array.from(n.entries()).map(([t,r])=>({key:`lineHeight:${t}`,label:`Line Height: ${t}px`,occurrences:r,count:r.length}))}function K(e){let n=new Map;for(let t of e){let r=Math.round(t.fontSize).toString(),o=n.get(r)||[];o.push(t),n.set(r,o)}return Array.from(n.entries()).map(([t,r])=>({key:`fontSize:${t}`,label:`Font Size: ${t}px`,occurrences:r,count:r.length}))}function J(e){let n=new Map;for(let t of e){let r=t.fontWeight,o=n.get(r)||[];o.push(t),n.set(r,o)}return Array.from(n.entries()).map(([t,r])=>({key:`fontWeight:${t}`,label:`Weight: ${t}`,occurrences:r,count:r.length}))}function Q(e){let n=new Map;for(let t of e){let r=t.font.family,o=n.get(r)||[];o.push(t),n.set(r,o)}return Array.from(n.entries()).map(([t,r])=>({key:`fontFamily:${t}`,label:`Family: ${t}`,occurrences:r,count:r.length}))}function _(e){return{lineHeight:j(e),fontSize:K(e),fontWeight:J(e),fontFamily:Q(e)}}var B=u(()=>{"use strict"});var h={};V(h,{default:()=>Y});function Y(){f("SCAN_FONTS",async function(){let e=figma.currentPage.selection;if(e.length===0){figma.notify("Please select at least one layer",{error:!0});return}let n=T(e);if(n.length===0){figma.notify("No text layers found in selection");return}let t=L(n),r=_(n),o=new Set(n.map(i=>i.nodeId));d("FONTS_SCANNED",{fonts:t,groups:r,totalNodes:o.size}),figma.notify(`Found ${t.length} fonts in ${o.size} text layers`)}),f("APPLY_REPLACEMENT",async function(e){let n={success:!1,affectedNodes:0,affectedRanges:0,errors:[]};try{await figma.loadFontAsync({family:e.newFont.family,style:e.newFont.style});let t=new Set;for(let r of e.occurrences)try{let o=figma.getNodeById(r.nodeId);if(!o||o.type!=="TEXT")continue;try{await figma.loadFontAsync({family:r.font.family,style:r.font.style})}catch(i){}if(o.setRangeFontName(r.rangeStart,r.rangeEnd,{family:e.newFont.family,style:e.newFont.style}),e.newLineHeight)try{o.setRangeLineHeight(r.rangeStart,r.rangeEnd,{value:e.newLineHeight,unit:"PIXELS"})}catch(i){o.lineHeight={value:e.newLineHeight,unit:"PIXELS"}}if(e.newFontSize)try{o.setRangeFontSize(r.rangeStart,r.rangeEnd,e.newFontSize)}catch(i){o.fontSize=e.newFontSize}n.affectedRanges++,t.add(o.id)}catch(o){n.errors.push(`Error updating node ${r.nodeId}: ${o}`)}n.affectedNodes=t.size,n.success=n.affectedRanges>0,n.success?figma.notify(`Updated ${n.affectedRanges} text ranges in ${n.affectedNodes} layers`):figma.notify("Failed to apply changes",{error:!0})}catch(t){n.errors.push(`Font loading failed: ${t}`),figma.notify("Failed to load font",{error:!0})}d("REPLACEMENT_COMPLETE",n)}),f("PREVIEW_SELECTION",function(e){let n=new Set(e.map(r=>r.nodeId)),t=[];for(let r of Array.from(n)){let o=figma.getNodeById(r);o&&t.push(o)}t.length>0&&(figma.currentPage.selection=t,figma.viewport.scrollAndZoomIntoView(t))}),f("REQUEST_AVAILABLE_FONTS",async function(){let e=await figma.listAvailableFontsAsync();d("AVAILABLE_FONTS",e)}),p("close",function(){figma.closePlugin()}),y({width:380,height:600})}var F=u(()=>{"use strict";M();B()});var Z={"src/main.ts--default":(F(),I(h)).default,open:(F(),I(h)).default},ee=typeof figma.command=="undefined"||figma.command===""||figma.command==="generate"?"src/main.ts--default":figma.command;Z[ee]();
